<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghost Patch | IoT Interface</title>
    <style>
        body { background-color: #121212; color: #e0e0e0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; flex-direction: column; align-items: center; margin: 0; padding: 20px; }
        h1 { color: #bb86fc; }
        .monitor-window { border: 2px solid #333; box-shadow: 0 0 20px rgba(0,0,0,0.5); border-radius: 8px; overflow: hidden; background: #000; min-width: 640px; min-height: 480px;}
        .monitor-window img { display: block; max-width: 100%; height: auto; }
        .stats-panel { margin-top: 20px; display: flex; gap: 20px; background: #1e1e1e; padding: 15px; border-radius: 8px; width: 640px; justify-content: space-between; align-items: center; }
        .stat-box { text-align: center; }
        .stat-val { font-size: 1.2em; font-weight: bold; color: #03dac6; }
        button { background-color: #cf6679; color: black; border: none; padding: 10px 25px; border-radius: 4px; font-weight: bold; cursor: pointer; transition: 0.2s; font-size: 16px; min-width: 150px;}
        button:hover { opacity: 0.9; }
        button.active { background-color: #03dac6; }
        footer { margin-top: 40px; font-size: 0.8em; color: #555; }
    </style>
</head>
<body>
    <h1>Universal Ghost Patch V2</h1>
    
    <div class="monitor-window">
        <!-- MJPEG Stream -->
        <img src="{{ url_for('video_feed') }}" alt="Video Stream Loading..." width="640" height="480">
    </div>

    <div class="stats-panel">
        <div class="stat-box">
            <div>FPS</div>
            <div id="fps" class="stat-val">0</div>
        </div>
        <div class="stat-box">
            <div>Status</div>
            <div id="status" class="stat-val" style="color: #bbb;">Clean</div>
        </div>
        <button id="toggleBtn" onclick="toggleAttack()">ACTIVATE GHOST</button>
    </div>

    <footer>
        Authors: Reikage & BaoZ | IoT Security Research
    </footer>

    <script>
        function toggleAttack() {
            fetch('/api/toggle', {method: 'POST'})
                .then(r => r.json())
                .then(updateUI)
                .catch(err => console.error(err));
        }

        function updateUI(data) {
            const btn = document.getElementById('toggleBtn');
            const status = document.getElementById('status');
            
            if(data.attack_active) {
                btn.classList.add('active');
                btn.innerText = "DEACTIVATE";
                status.style.color = "#cf6679";
            } else {
                btn.classList.remove('active');
                btn.innerText = "ACTIVATE GHOST";
                status.style.color = "#bbb";
            }
            status.innerText = data.mode;
        }

        setInterval(() => {
            fetch('/api/stats').then(r => r.json()).then(data => {
                document.getElementById('fps').innerText = data.fps;
                updateUI(data); // Sync state
            }).catch(err => console.log("Stats error (server offline?)"));
        }, 2000);
    </script>
</body>
</html>
